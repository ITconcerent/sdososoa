
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏ - iStore Admin</title>
    <link rel="stylesheet" href="admin-products.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ */
        .users-section {
            display: none;
        }
        
        .users-section.active {
            display: block;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .users-table th,
        .users-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e1e1e1;
        }
        
        .users-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }
        
        .user-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-blocked {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-admin {
            background: #cce7ff;
            color: #004085;
        }
        
        .user-actions {
            display: flex;
            gap: 5px;
        }
        
        .user-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .user-btn.block {
            background: #e53935;
            color: white;
        }
        
        .user-btn.unblock {
            background: #4CAF50;
            color: white;
        }
        
        .user-btn.admin {
            background: #007aff;
            color: white;
        }
        
        .user-btn.history {
            background: #ffa000;
            color: white;
        }
        
        .user-btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }
        
        .empty-users {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-users i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .admin-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .admin-tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .admin-tab.active {
            border-bottom-color: #007aff;
            color: #007aff;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —á–∞—Ç—É –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ */
        .support-chat-section {
            display: none;
        }
        
        .support-chat-section.active {
            display: block;
        }
        
        .support-chat-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            height: 600px;
        }
        
        .chat-users-list {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-y: auto;
        }
        
        .chat-user-item {
            padding: 15px 20px;
            border-bottom: 1px solid #e1e1e1;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .chat-user-item:hover {
            background: #f8f9fa;
        }
        
        .chat-user-item.active {
            background: #007aff;
            color: white;
        }
        
        .chat-user-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .chat-user-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .chat-user-last-message {
            font-size: 12px;
            color: #666;
            opacity: 0.8;
            line-height: 1.3;
        }
        
        .chat-user-item.active .chat-user-last-message {
            color: white;
        }
        
        .chat-user-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        
        .chat-user-time {
            font-size: 11px;
            color: #999;
            white-space: nowrap;
        }
        
        .chat-user-item.active .chat-user-time {
            color: white;
        }
        
        .unread-badge {
            background: #e53935;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
        }
        
        .admin-chat-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .admin-chat-header {
            padding: 20px;
            border-bottom: 1px solid #e1e1e1;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
            min-height: 80px;
            display: flex;
            align-items: center;
        }
        
        .selected-chat-info h3 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .selected-chat-info p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        
        .admin-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #f8f9fa;
        }
        
        .admin-message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 15px;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.4;
        }
        
        .admin-message.user {
            align-self: flex-start;
            background: white;
            color: #333;
            border: 1px solid #e1e1e1;
            border-bottom-left-radius: 5px;
        }
        
        .admin-message.agent {
            align-self: flex-end;
            background: #007aff;
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .admin-message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .admin-message.user .admin-message-time {
            text-align: left;
        }
        
        .admin-message.agent .admin-message-time {
            text-align: right;
        }
        
        .admin-chat-input-container {
            padding: 20px;
            border-top: 1px solid #e1e1e1;
        }
        
        .admin-chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        .admin-chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e1e1e1;
            border-radius: 25px;
            resize: none;
            font-size: 14px;
            transition: border-color 0.3s;
            max-height: 120px;
            min-height: 50px;
            font-family: inherit;
        }
        
        .admin-chat-input:focus {
            border-color: #007aff;
            outline: none;
        }
        
        .admin-send-btn {
            background: #007aff;
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .admin-send-btn:hover {
            background: #0056cc;
            transform: scale(1.05);
        }
        
        .admin-send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .no-chat-selected {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            color: #666;
            text-align: center;
            padding: 40px;
        }
        
        .no-chat-selected i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .no-chat-selected h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        .no-chat-selected p {
            margin: 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–ª—è —á–∞—Ç—É */
        @media (max-width: 1024px) {
            .support-chat-layout {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .chat-users-list {
                max-height: 250px;
            }
            
            .admin-chat-container {
                height: 500px;
            }
        }
        
        @media (max-width: 768px) {
            .support-chat-layout {
                gap: 15px;
            }
            
            .admin-message {
                max-width: 85%;
            }
            
            .chat-user-item {
                padding: 12px 15px;
            }
        }
        
        @media (max-width: 480px) {
            .admin-message {
                max-width: 90%;
                padding: 10px 14px;
            }
            
            .admin-chat-messages {
                padding: 15px;
            }
            
            .admin-chat-input-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="products-admin-container">
        <!-- Header -->
        <header class="products-header">
            <div class="header-left">
                <h1>üì¶ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏</h1>
                <span class="products-count" id="products-count">0 —Ç–æ–≤–∞—Ä—ñ–≤</span>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" onclick="openAddProductModal()">
                    <i class="fas fa-plus"></i>
                    –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
                </button>
                <button class="btn btn-secondary" onclick="exportProducts()">
                    <i class="fas fa-download"></i>
                    –ï–∫—Å–ø–æ—Ä—Ç
                </button>
                <button class="btn btn-success" onclick="syncWithMainSite()">
                    <i class="fas fa-sync"></i>
                    –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏
                </button>
            </div>
        </header>

        <!-- Admin Tabs -->
        <div class="admin-tabs">
            <div class="admin-tab active" onclick="switchAdminTab('products')">–¢–æ–≤–∞—Ä–∏</div>
            <div class="admin-tab" onclick="switchAdminTab('users')">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</div>
            <div class="admin-tab" onclick="switchAdminTab('support-chat')">–ß–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</div>
        </div>

        <!-- Products Section -->
        <div class="products-section active" id="products-section">
            <!-- Filters -->
            <div class="products-filters">
                <div class="filter-group">
                    <input type="text" id="search-products" placeholder="üîç –ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—ñ–≤..." oninput="filterProducts()">
                </div>
                <div class="filter-group">
                    <select id="category-filter" onchange="filterProducts()">
                        <option value="">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
                        <option value="iphone">iPhone</option>
                        <option value="ipad">iPad</option>
                        <option value="macbook">MacBook</option>
                        <option value="apple-watch">Apple Watch</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select id="status-filter" onchange="filterProducts()">
                        <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                        <option value="in-stock">–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</option>
                        <option value="out-of-stock">–ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</option>
                    </select>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="products-grid" id="products-grid">
                <!-- –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏—Å—å —Ç—É—Ç -->
            </div>
        </div>

        <!-- Users Section -->
        <div class="users-section" id="users-section">
            <div class="products-filters">
                <div class="filter-group">
                    <input type="text" id="search-users" placeholder="üîç –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤..." oninput="filterUsers()">
                </div>
                <div class="filter-group">
                    <select id="status-users-filter" onchange="filterUsers()">
                        <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ñ</option>
                        <option value="blocked">–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ</option>
                        <option value="admin">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏</option>
                    </select>
                </div>
            </div>

            <div class="users-container">
                <table class="users-table" id="users-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–Ü–º'—è</th>
                            <th>Email</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</th>
                            <th>–î—ñ—ó</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <!-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —Ç—É—Ç -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Support Chat Section -->
        <div class="support-chat-section" id="support-chat-section">
            <div class="support-chat-layout">
                <div class="chat-users-list" id="chat-users-list">
                    <!-- –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –∞–∫—Ç–∏–≤–Ω–∏–º–∏ —á–∞—Ç–∞–º–∏ -->
                </div>
                
                <div class="admin-chat-container">
                    <div class="admin-chat-header" id="admin-chat-header">
                        <div class="no-chat-selected" id="no-chat-selected">
                            <i class="fas fa-comments"></i>
                            <h3>–û–±–µ—Ä—ñ—Ç—å —á–∞—Ç –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É</h3>
                            <p>–í–∏–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑—ñ —Å–ø–∏—Å–∫—É, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</p>
                        </div>
                        <div class="selected-chat-info" id="selected-chat-info" style="display: none;">
                            <h3 id="selected-user-name">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</h3>
                            <p id="selected-user-status">–û–Ω–ª–∞–π–Ω</p>
                        </div>
                    </div>
                    
                    <div class="admin-chat-messages" id="admin-chat-messages">
                        <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –±—É–¥—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏—Å—å —Ç—É—Ç -->
                    </div>
                    
                    <div class="admin-chat-input-container" id="admin-chat-input-container" style="display: none;">
                        <div class="admin-chat-input-wrapper">
                            <textarea 
                                class="admin-chat-input" 
                                id="admin-message-input" 
                                placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å..."
                                rows="1"
                            ></textarea>
                            <button class="admin-send-btn" id="admin-send-btn" onclick="sendAdminMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add/Edit Product Modal -->
        <div class="modal" id="product-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title">–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h2>
                    <button class="close-btn" onclick="closeProductModal()">&times;</button>
                </div>
                
                <form id="product-form" onsubmit="saveProduct(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-name">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É *</label>
                            <input type="text" id="product-name" required>
                        </div>
                        <div class="form-group">
                            <label for="product-model">–ú–æ–¥–µ–ª—å *</label>
                            <input type="text" id="product-model" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-category">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è *</label>
                            <select id="product-category" required>
                                <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
                                <option value="iphone">iPhone</option>
                                <option value="ipad">iPad</option>
                                <option value="macbook">MacBook</option>
                                <option value="apple-watch">Apple Watch</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="product-price">–¶—ñ–Ω–∞ (‚Ç¥) *</label>
                            <input type="number" id="product-price" min="0" step="1" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="product-specs">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
                        <input type="text" id="product-specs" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 6.1'' Super Retina XDR">
                    </div>

                    <div class="form-group">
                        <label for="product-description">–û–ø–∏—Å</label>
                        <textarea id="product-description" rows="3" placeholder="–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É..."></textarea>
                    </div>

                    <!-- Image Upload -->
                    <div class="form-group">
                        <label>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É</label>
                        <div class="image-upload-container">
                            <div class="image-previews" id="image-previews">
                                <div class="image-preview-placeholder">
                                    <i class="fas fa-images"></i>
                                    <span>–î–æ–¥–∞–π—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä—É</span>
                                </div>
                            </div>
                            <div class="upload-controls">
                                <input type="file" id="product-images" accept="image/*" multiple style="display: none;" onchange="handleImageUpload(event)">
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('product-images').click()">
                                    <i class="fas fa-plus"></i>
                                    –î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ
                                </button>
                                <button type="button" class="btn btn-outline" onclick="clearAllImages()">
                                    <i class="fas fa-trash"></i>
                                    –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ
                                </button>
                            </div>
                            <div class="upload-info">
                                <small>–ú–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ 5 —Ñ–æ—Ç–æ. –ü–µ—Ä—à–µ —Ñ–æ—Ç–æ –±—É–¥–µ –æ—Å–Ω–æ–≤–Ω–∏–º.</small>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Characteristics -->
                    <div class="form-group">
                        <label>–î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
                        <div id="characteristics-container">
                            <!-- Characteristics will be added here -->
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addCharacteristic()">
                            <i class="fas fa-plus"></i>
                            –î–æ–¥–∞—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É
                        </button>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeProductModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        <button type="submit" class="btn btn-primary" id="save-product-btn">–ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ–≤–∞—Ä</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal" id="delete-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä</h2>
                </div>
                <p>–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä? –¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.</p>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                </div>
            </div>
        </div>

        <!-- User History Modal -->
        <div class="modal" id="user-history-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h2>
                    <button class="close-btn" onclick="closeUserHistoryModal()">&times;</button>
                </div>
                <div class="user-history-content" id="user-history-content">
                    <!-- –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ —Ç—É—Ç -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
        let products = JSON.parse(localStorage.getItem('adminProducts')) || [];
        let currentEditingId = null;
        let productToDelete = null;
        let productImages = [];
        let currentEditingUser = null;
        let currentChatUser = null;
        let supportChatInterval = null;

        // Broadcast Channel –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
        const broadcastChannel = new BroadcastChannel('products_updates');
        const supportChannel = new BroadcastChannel('support_messages');

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–æ–¥—É–ª—è —Ç–æ–≤–∞—Ä—ñ–≤...');
            loadProducts();
            loadUsers();
            loadSupportChats();
            updateProductsCount();
            setupBroadcastListener();
            autoSyncOnLoad();
            startSupportPolling();
            
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–ª—ñ–≤ —á–∞—Ç—É
            initializeChatFields();
        });

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–ª—ñ–≤ –≤–≤–µ–¥–µ–Ω–Ω—è —á–∞—Ç—É
        function initializeChatFields() {
            const adminMessageInput = document.getElementById('admin-message-input');
            if (adminMessageInput) {
                adminMessageInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });

                adminMessageInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendAdminMessage();
                    }
                });
            }
        }

        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ª—É—Ö–∞—á–∞ –æ–Ω–æ–≤–ª–µ–Ω—å
        function setupBroadcastListener() {
            broadcastChannel.onmessage = (event) => {
                if (event.data.type === 'products_updated') {
                    console.log('–û—Ç—Ä–∏–º–∞–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤');
                    loadProducts();
                    updateProductsCount();
                }
            };
            
            supportChannel.onmessage = (event) => {
                if (event.data.type === 'messages_updated') {
                    console.log('–û—Ç—Ä–∏–º–∞–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—ñ–¥—Ç—Ä–∏–º–∫–∏');
                    loadSupportChats();
                    if (currentChatUser) {
                        loadChatMessages(currentChatUser);
                    }
                }
            };
        }

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ –≤–∫–ª–∞–¥–∫–∞–º–∏
        function switchAdminTab(tab) {
            // –û–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω—ñ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.products-section, .users-section, .support-chat-section').forEach(s => s.classList.remove('active'));
            
            // –ê–∫—Ç–∏–≤—É—î–º–æ –æ–±—Ä–∞–Ω—É –≤–∫–ª–∞–¥–∫—É
            const tabIndex = {'products': 1, 'users': 2, 'support-chat': 3}[tab];
            const tabElement = document.querySelector(`.admin-tab:nth-child(${tabIndex})`);
            const sectionElement = document.getElementById(`${tab}-section`);
            
            if (tabElement) tabElement.classList.add('active');
            if (sectionElement) sectionElement.classList.add('active');
        }

        // ========== –°–ò–°–¢–ï–ú–ê –ß–ê–¢–£ –ü–Ü–î–¢–†–ò–ú–ö–ò ==========

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —á–∞—Ç—ñ–≤
        function loadSupportChats() {
            const chatUsersList = document.getElementById('chat-users-list');
            const allMessages = getAllSupportMessages();
            
            // –û—Ç—Ä–∏–º—É—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
            const uniqueUsers = {};
            allMessages.forEach(msg => {
                if (!uniqueUsers[msg.userId]) {
                    uniqueUsers[msg.userId] = {
                        userId: msg.userId,
                        lastMessage: msg.text,
                        lastMessageTime: msg.timestamp,
                        unread: countUnreadMessages(msg.userId)
                    };
                } else {
                    // –û–Ω–æ–≤–ª—é—î–º–æ –æ—Å—Ç–∞–Ω–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫—â–æ –≤–æ–Ω–æ –Ω–æ–≤—ñ—à–µ
                    if (new Date(msg.timestamp) > new Date(uniqueUsers[msg.userId].lastMessageTime)) {
                        uniqueUsers[msg.userId].lastMessage = msg.text;
                        uniqueUsers[msg.userId].lastMessageTime = msg.timestamp;
                    }
                }
            });
            
            const usersArray = Object.values(uniqueUsers);
            
            if (usersArray.length === 0) {
                chatUsersList.innerHTML = `
                    <div class="empty-users">
                        <i class="fas fa-comments"></i>
                        <h3>–ß–∞—Ç—ñ–≤ –Ω–µ–º–∞—î</h3>
                        <p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —â–µ –Ω–µ –∑–≤–µ—Ä—Ç–∞–ª–∏—Å—è –¥–æ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</p>
                    </div>
                `;
                return;
            }
            
            // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ —á–∞—Å–æ–º –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            usersArray.sort((a, b) => new Date(b.lastMessageTime) - new Date(a.lastMessageTime));
            
            chatUsersList.innerHTML = usersArray.map(user => `
                <div class="chat-user-item ${currentChatUser === user.userId ? 'active' : ''}" onclick="selectChatUser('${user.userId}')">
                    <div class="chat-user-info">
                        <div class="chat-user-name">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${user.userId.substring(5)}</div>
                        <div class="chat-user-last-message">${user.lastMessage.length > 50 ? user.lastMessage.substring(0, 50) + '...' : user.lastMessage}</div>
                    </div>
                    <div class="chat-user-meta">
                        <div class="chat-user-time">${formatMessageTime(user.lastMessageTime)}</div>
                        ${user.unread > 0 ? `<div class="unread-badge">${user.unread}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏
        function getAllSupportMessages() {
            return JSON.parse(localStorage.getItem('supportMessages')) || [];
        }

        // –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        function getUserSupportMessages(userId) {
            const allMessages = getAllSupportMessages();
            return allMessages.filter(msg => msg.userId === userId);
        }

        // –ü—ñ–¥—Ä–∞—Ö—É–≤–∞—Ç–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        function countUnreadMessages(userId) {
            const userMessages = getUserSupportMessages(userId);
            return userMessages.filter(msg => msg.type === 'user' && !msg.read).length;
        }

        // –í–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è —á–∞—Ç—É
        function selectChatUser(userId) {
            currentChatUser = userId;
            loadSupportChats();
            loadChatMessages(userId);
            
            // –ü–æ–∑–Ω–∞—á–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —è–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ
            markMessagesAsRead(userId);
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —á–∞—Ç—É
        function loadChatMessages(userId) {
            const adminChatMessages = document.getElementById('admin-chat-messages');
            const userMessages = getUserSupportMessages(userId);
            
            adminChatMessages.innerHTML = '';
            
            userMessages.forEach(msg => {
                addAdminMessageToChat(msg.text, msg.type, msg.timestamp, false);
            });
            
            adminChatMessages.scrollTop = adminChatMessages.scrollHeight;
            
            // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–∏–±—Ä–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            document.getElementById('no-chat-selected').style.display = 'none';
            document.getElementById('selected-chat-info').style.display = 'block';
            document.getElementById('admin-chat-input-container').style.display = 'block';
            
            document.getElementById('selected-user-name').textContent = `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${userId.substring(5)}`;
        }

        // –î–æ–¥–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∞–¥–º—ñ–Ω-—á–∞—Ç
        function addAdminMessageToChat(text, sender, timestamp, animate = true) {
            const adminChatMessages = document.getElementById('admin-chat-messages');
            const messageDiv = document.createElement('div');
            
            const messageTime = new Date(timestamp);
            const timeString = messageTime.getHours().toString().padStart(2, '0') + ':' + 
                             messageTime.getMinutes().toString().padStart(2, '0');
            
            messageDiv.className = `admin-message ${sender}`;
            if (animate) {
                messageDiv.style.animation = 'fadeIn 0.3s ease-out';
            }
            
            messageDiv.innerHTML = `
                <div class="admin-message-text">${text}</div>
                <div class="admin-message-time">${timeString}</div>
            `;
            
            adminChatMessages.appendChild(messageDiv);
            adminChatMessages.scrollTop = adminChatMessages.scrollHeight;
        }

        // –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –∞–¥–º—ñ–Ω–∞
        function sendAdminMessage() {
            if (!currentChatUser) {
                showNotification('–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ', 'error');
                return;
            }
            
            const messageInput = document.getElementById('admin-message-input');
            const messageText = messageInput.value.trim();
            
            if (messageText === '') {
                showNotification('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è', 'error');
                return;
            }
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            const message = {
                id: 'msg_' + Date.now(),
                userId: currentChatUser,
                text: messageText,
                type: 'agent',
                timestamp: new Date().toISOString(),
                read: true
            };
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ
            saveSupportMessage(message);
            addAdminMessageToChat(messageText, 'agent', message.timestamp, true);
            
            // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ –≤–≤–µ–¥–µ–Ω–Ω—è
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î–º–æ –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
            broadcastSupportUpdate();
            
            showNotification('–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ', 'success');
        }

        // –ó–±–µ—Ä–µ–≥—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏
        function saveSupportMessage(message) {
            const allMessages = getAllSupportMessages();
            allMessages.push(message);
            localStorage.setItem('supportMessages', JSON.stringify(allMessages));
        }

        // –ü–æ–∑–Ω–∞—á–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —è–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ
        function markMessagesAsRead(userId) {
            const allMessages = getAllSupportMessages();
            let updated = false;
            
            allMessages.forEach(msg => {
                if (msg.userId === userId && msg.type === 'user' && !msg.read) {
                    msg.read = true;
                    updated = true;
                }
            });
            
            if (updated) {
                localStorage.setItem('supportMessages', JSON.stringify(allMessages));
                loadSupportChats();
            }
        }

        // –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–∞—Å—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        function formatMessageTime(timestamp) {
            const messageTime = new Date(timestamp);
            const now = new Date();
            const diffMs = now - messageTime;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return '—â–æ–π–Ω–æ';
            if (diffMins < 60) return `${diffMins} —Ö–≤`;
            if (diffHours < 24) return `${diffHours} –≥–æ–¥`;
            if (diffDays < 7) return `${diffDays} –¥–Ω`;
            
            return messageTime.toLocaleDateString('uk-UA');
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω—å
        function broadcastSupportUpdate() {
            localStorage.setItem('supportLastUpdate', Date.now().toString());
            
            if (typeof BroadcastChannel !== 'undefined') {
                const channel = new BroadcastChannel('support_messages');
                channel.postMessage({
                    type: 'messages_updated',
                    timestamp: Date.now()
                });
            }
        }

        // –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–∞—Ç—É
        function startSupportPolling() {
            supportChatInterval = setInterval(() => {
                const lastUpdate = localStorage.getItem('supportLastUpdate');
                const currentUpdate = localStorage.getItem('currentAdminSupportUpdate');
                
                if (lastUpdate !== currentUpdate) {
                    loadSupportChats();
                    if (currentChatUser) {
                        loadChatMessages(currentChatUser);
                    }
                    localStorage.setItem('currentAdminSupportUpdate', lastUpdate);
                }
            }, 2000);
        }

        // ========== –£–ü–†–ê–í–õ–Ü–ù–ù–Ø –ö–û–†–ò–°–¢–£–í–ê–ß–ê–ú–ò ==========

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        function loadUsers() {
            const usersTableBody = document.getElementById('users-table-body');
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            
            if (usersDatabase.length === 0) {
                usersTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-users">
                            <i class="fas fa-users"></i>
                            <h3>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
                            <p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑'—è–≤–ª—è—Ç—å—Å—è –ø—ñ—Å–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –Ω–∞ —Å–∞–π—Ç—ñ</p>
                        </td>
                    </tr>
                `;
                return;
            }

            usersTableBody.innerHTML = usersDatabase.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</td>
                    <td>
                        <span class="user-status ${getUserStatusClass(user)}">
                            ${getUserStatusText(user)}
                        </span>
                    </td>
                    <td>${new Date(user.createdAt).toLocaleDateString('uk-UA')}</td>
                    <td class="user-actions">
                        ${user.isBlocked ? 
                            `<button class="user-btn unblock" onclick="toggleUserBlock(${user.id})">
                                <i class="fas fa-unlock"></i> –†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏
                            </button>` :
                            `<button class="user-btn block" onclick="toggleUserBlock(${user.id})">
                                <i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏
                            </button>`
                        }
                        ${!user.isAdmin ? 
                            `<button class="user-btn admin" onclick="toggleAdminStatus(${user.id})">
                                <i class="fas fa-crown"></i> –ó—Ä–æ–±–∏—Ç–∏ –∞–¥–º—ñ–Ω–æ–º
                            </button>` :
                            `<button class="user-btn admin" onclick="toggleAdminStatus(${user.id})" style="background: #6c757d;">
                                <i class="fas fa-user"></i> –ó–∞–±—Ä–∞—Ç–∏ –ø—Ä–∞–≤–∞
                            </button>`
                        }
                        <button class="user-btn history" onclick="showUserHistory(${user.id})">
                            <i class="fas fa-history"></i> –Ü—Å—Ç–æ—Ä—ñ—è
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–ª–∞—Å—É —Å—Ç–∞—Ç—É—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        function getUserStatusClass(user) {
            if (user.isBlocked) return 'status-blocked';
            if (user.isAdmin) return 'status-admin';
            return 'status-active';
        }

        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É —Å—Ç–∞—Ç—É—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        function getUserStatusText(user) {
            if (user.isBlocked) return '–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π';
            if (user.isAdmin) return '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä';
            return '–ê–∫—Ç–∏–≤–Ω–∏–π';
        }

        // –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è/—Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        function toggleUserBlock(userId) {
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            const userIndex = usersDatabase.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                usersDatabase[userIndex].isBlocked = !usersDatabase[userIndex].isBlocked;
                localStorage.setItem('storeUsers', JSON.stringify(usersDatabase));
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫—â–æ —Ü–µ –≤—ñ–Ω
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (currentUser && currentUser.id === userId) {
                    currentUser.isBlocked = usersDatabase[userIndex].isBlocked;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                loadUsers();
                showNotification(usersDatabase[userIndex].isBlocked ? 
                    '‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ' : '‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ', 'success');
            }
        }

        // –ó–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        function toggleAdminStatus(userId) {
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            const userIndex = usersDatabase.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                usersDatabase[userIndex].isAdmin = !usersDatabase[userIndex].isAdmin;
                localStorage.setItem('storeUsers', JSON.stringify(usersDatabase));
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫—â–æ —Ü–µ –≤—ñ–Ω
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (currentUser && currentUser.id === userId) {
                    currentUser.isAdmin = usersDatabase[userIndex].isAdmin;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                loadUsers();
                showNotification(usersDatabase[userIndex].isAdmin ? 
                    '‚úÖ –ü—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω–∞ –Ω–∞–¥–∞–Ω–æ' : '‚úÖ –ü—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω–∞ –∑–∞–±—Ä–∞–Ω–æ', 'success');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –∑–∞–º–æ–≤–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        function showUserHistory(userId) {
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            const user = usersDatabase.find(u => u.id === userId);
            
            if (!user) return;

            const historyContent = document.getElementById('user-history-content');
            const orders = user.orders || [];

            if (orders.length === 0) {
                historyContent.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #666;">
                        <i class="fas fa-shopping-bag" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3>–ó–∞–º–æ–≤–ª–µ–Ω—å –Ω–µ–º–∞—î</h3>
                        <p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —â–µ –Ω–µ —Ä–æ–±–∏–≤ –∑–∞–º–æ–≤–ª–µ–Ω—å</p>
                    </div>
                `;
            } else {
                historyContent.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <h3>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${user.name}</h3>
                        <p>Email: ${user.email}</p>
                        <p>–í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: ${orders.length}</p>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${orders.map(order => `
                            <div style="border: 1px solid #e1e1e1; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <strong>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #${order.id}</strong>
                                    <span style="color: #e53935; font-weight: bold;">${order.total ? order.total.toLocaleString('uk-UA') + ' ‚Ç¥' : '–¶—ñ–Ω–∞ –Ω–µ –≤–∫–∞–∑–∞–Ω–∞'}</span>
                                </div>
                                <div style="color: #666; font-size: 14px;">
                                    <div>–î–∞—Ç–∞: ${new Date(order.date).toLocaleDateString('uk-UA')}</div>
                                    <div>–°—Ç–∞—Ç—É—Å: ${order.status === 'completed' ? '‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ' : '‚è≥ –í –æ–±—Ä–æ–±—Ü—ñ'}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            document.getElementById('user-history-modal').classList.add('active');
        }

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ —ñ—Å—Ç–æ—Ä—ñ—ó
        function closeUserHistoryModal() {
            document.getElementById('user-history-modal').classList.remove('active');
        }

        // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        function filterUsers() {
            const searchTerm = document.getElementById('search-users').value.toLowerCase();
            const statusFilter = document.getElementById('status-users-filter').value;
            
            const usersTableBody = document.getElementById('users-table-body');
            const usersDatabase = JSON.parse(localStorage.getItem('storeUsers')) || [];
            
            const filteredUsers = usersDatabase.filter(user => {
                const matchesSearch = user.name.toLowerCase().includes(searchTerm) || 
                                    user.email.toLowerCase().includes(searchTerm);
                
                let matchesStatus = true;
                if (statusFilter === 'active') {
                    matchesStatus = !user.isBlocked && !user.isAdmin;
                } else if (statusFilter === 'blocked') {
                    matchesStatus = user.isBlocked;
                } else if (statusFilter === 'admin') {
                    matchesStatus = user.isAdmin;
                }
                
                return matchesSearch && matchesStatus;
            });

            if (filteredUsers.length === 0) {
                usersTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px 20px; color: #666;">
                            <i class="fas fa-search"></i>
                            <p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>
                        </td>
                    </tr>
                `;
                return;
            }

            usersTableBody.innerHTML = filteredUsers.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</td>
                    <td>
                        <span class="user-status ${getUserStatusClass(user)}">
                            ${getUserStatusText(user)}
                        </span>
                    </td>
                    <td>${new Date(user.createdAt).toLocaleDateString('uk-UA')}</td>
                    <td class="user-actions">
                        ${user.isBlocked ? 
                            `<button class="user-btn unblock" onclick="toggleUserBlock(${user.id})">
                                <i class="fas fa-unlock"></i> –†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏
                            </button>` :
                            `<button class="user-btn block" onclick="toggleUserBlock(${user.id})">
                                <i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏
                            </button>`
                        }
                        ${!user.isAdmin ? 
                            `<button class="user-btn admin" onclick="toggleAdminStatus(${user.id})">
                                <i class="fas fa-crown"></i> –ó—Ä–æ–±–∏—Ç–∏ –∞–¥–º—ñ–Ω–æ–º
                            </button>` :
                            `<button class="user-btn admin" onclick="toggleAdminStatus(${user.id})" style="background: #6c757d;">
                                <i class="fas fa-user"></i> –ó–∞–±—Ä–∞—Ç–∏ –ø—Ä–∞–≤–∞
                            </button>`
                        }
                        <button class="user-btn history" onclick="showUserHistory(${user.id})">
                            <i class="fas fa-history"></i> –Ü—Å—Ç–æ—Ä—ñ—è
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω—å
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#e53935' : '#007aff'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                animation: slideInRight 0.3s ease-out;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            notification.innerHTML = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        // ========== –§–£–ù–ö–¶–Ü–á –î–õ–Ø –¢–û–í–ê–†–Ü–í (–±–µ–∑ –∑–º—ñ–Ω) ==========
        
        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤
        function loadProducts() {
            const productsGrid = document.getElementById('products-grid');
            
            if (products.length === 0) {
                productsGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 20px;">üì¶</div>
                        <h3 style="margin-bottom: 10px; color: #333;">–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤</h3>
                        <p style="margin-bottom: 25px; color: #666;">–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π —Ç–æ–≤–∞—Ä –¥–æ –≤–∞—à–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω—É</p>
                        <button class="btn btn-primary" onclick="openAddProductModal()">
                            <i class="fas fa-plus"></i>
                            –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
                        </button>
                    </div>
                `;
                return;
            }

            productsGrid.innerHTML = products.map(product => `
                <div class="product-card" data-category="${product.category}" data-status="${product.status || 'in-stock'}">
                    <div class="product-image">
                        ${product.mainImage || product.image ? 
                            `<img src="${product.mainImage || product.image}" alt="${product.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"> 
                             <div class="placeholder" style="display: none;"><i class="fas fa-image"></i></div>` :
                            `<div class="placeholder"><i class="fas fa-image"></i></div>`
                        }
                    </div>
                    <div class="product-info">
                        <div class="product-model">${product.model}</div>
                        <h3>${product.name}</h3>
                        <div class="product-specs">${product.specs || ''}</div>
                        <div class="product-price">${formatPrice(product.price)} ‚Ç¥</div>
                        <div class="product-status" style="font-size: 12px; color: ${product.status === 'out-of-stock' ? '#e53935' : '#4CAF50'}; margin-bottom: 10px;">
                            ${product.status === 'out-of-stock' ? '‚ùå –ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ' : '‚úÖ –í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ'}
                        </div>
                        <div class="product-actions">
                            <button class="btn btn-outline" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                                –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                            </button>
                            <button class="btn btn-danger" onclick="openDeleteModal(${product.id})">
                                <i class="fas fa-trash"></i>
                                –í–∏–¥–∞–ª–∏—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ü—ñ–Ω–∏
        function formatPrice(price) {
            return parseInt(price).toLocaleString('uk-UA');
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤
        function updateProductsCount() {
            const countElement = document.getElementById('products-count');
            countElement.textContent = `${products.length} —Ç–æ–≤–∞—Ä${products.length % 10 === 1 ? '' : '–∏'}`;
        }

        // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç–æ–≤–∞—Ä—ñ–≤
        function filterProducts() {
            const searchTerm = document.getElementById('search-products').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            
            const productCards = document.querySelectorAll('.product-card');
            
            productCards.forEach(card => {
                const productName = card.querySelector('h3').textContent.toLowerCase();
                const productCategory = card.getAttribute('data-category');
                const productStatus = card.getAttribute('data-status');
                
                const matchesSearch = productName.includes(searchTerm);
                const matchesCategory = !categoryFilter || productCategory === categoryFilter;
                const matchesStatus = !statusFilter || productStatus === statusFilter;
                
                card.style.display = (matchesSearch && matchesCategory && matchesStatus) ? 'block' : 'none';
            });
        }

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        function openAddProductModal() {
            currentEditingId = null;
            productImages = [];
            document.getElementById('modal-title').textContent = '–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä';
            document.getElementById('product-form').reset();
            updateImagePreviews();
            document.getElementById('characteristics-container').innerHTML = '';
            document.getElementById('product-modal').classList.add('active');
        }

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ —Ç–æ–≤–∞—Ä—É
        function closeProductModal() {
            document.getElementById('product-modal').classList.remove('active');
        }

        // –û–±—Ä–æ–±–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö —Ñ–æ—Ç–æ
        function handleImageUpload(event) {
            const files = event.target.files;
            const previewsContainer = document.getElementById('image-previews');
            
            const placeholder = previewsContainer.querySelector('.image-preview-placeholder');
            if (placeholder) {
                placeholder.remove();
            }
            
            for (let i = 0; i < files.length; i++) {
                if (productImages.length >= 5) {
                    alert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ 5 —Ñ–æ—Ç–æ');
                    break;
                }
                
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const imageData = {
                        id: Date.now() + i,
                        data: e.target.result,
                        isMain: productImages.length === 0
                    };
                    
                    productImages.push(imageData);
                    updateImagePreviews();
                };
                
                reader.readAsDataURL(file);
            }
            
            event.target.value = '';
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–µ–≤'—é —Ñ–æ—Ç–æ
        function updateImagePreviews() {
            const previewsContainer = document.getElementById('image-previews');
            previewsContainer.innerHTML = '';
            
            if (productImages.length === 0) {
                previewsContainer.innerHTML = `
                    <div class="image-preview-placeholder">
                        <i class="fas fa-images"></i>
                        <span>–î–æ–¥–∞–π—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä—É</span>
                    </div>
                `;
                return;
            }
            
            productImages.forEach((image, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = `image-preview-item ${image.isMain ? 'main-image' : ''}`;
                previewItem.innerHTML = `
                    <img src="${image.data}" alt="Preview ${index + 1}">
                    ${image.isMain ? '<div class="main-badge">–ì–æ–ª–æ–≤–Ω–µ</div>' : ''}
                    <div class="image-actions">
                        <button class="image-action-btn" onclick="setAsMainImage(${image.id})" title="–ó—Ä–æ–±–∏—Ç–∏ –≥–æ–ª–æ–≤–Ω–∏–º">
                            <i class="fas fa-star"></i>
                        </button>
                        <button class="image-action-btn" onclick="removeImage(${image.id})" title="–í–∏–¥–∞–ª–∏—Ç–∏">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                previewsContainer.appendChild(previewItem);
            });
        }

        // –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ñ–æ—Ç–æ —è–∫ –≥–æ–ª–æ–≤–Ω–µ
        function setAsMainImage(imageId) {
            productImages.forEach(image => {
                image.isMain = image.id === imageId;
            });
            updateImagePreviews();
        }

        // –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–æ—Ç–æ
        function removeImage(imageId) {
            const imageIndex = productImages.findIndex(img => img.id === imageId);
            const isMain = productImages[imageIndex].isMain;
            
            productImages.splice(imageIndex, 1);
            
            if (isMain && productImages.length > 0) {
                productImages[0].isMain = true;
            }
            
            updateImagePreviews();
        }

        // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ñ–æ—Ç–æ
        function clearAllImages() {
            productImages = [];
            updateImagePreviews();
        }

        // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
        function addCharacteristic() {
            const container = document.getElementById('characteristics-container');
            const index = container.children.length;
            
            const characteristicRow = document.createElement('div');
            characteristicRow.className = 'characteristic-row';
            characteristicRow.innerHTML = `
                <input type="text" placeholder="–ù–∞–∑–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–Ω–∞–ø—Ä. –ü—Ä–æ—Ü–µ—Å–æ—Ä)" name="characteristic-key-${index}">
                <input type="text" placeholder="–ó–Ω–∞—á–µ–Ω–Ω—è (–Ω–∞–ø—Ä. A15 Bionic)" name="characteristic-value-${index}">
                <button type="button" class="remove-characteristic" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(characteristicRow);
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        function saveProduct(event) {
            event.preventDefault();
            
            const formData = {
                id: currentEditingId || Date.now(),
                name: document.getElementById('product-name').value,
                model: document.getElementById('product-model').value,
                category: document.getElementById('product-category').value,
                price: parseInt(document.getElementById('product-price').value),
                specs: document.getElementById('product-specs').value,
                description: document.getElementById('product-description').value,
                status: 'in-stock',
                createdAt: new Date().toISOString(),
                lastUpdated: Date.now()
            };
            
            formData.images = productImages.map(img => img.data);
            formData.mainImage = productImages.find(img => img.isMain)?.data || '';
            
            finalizeSave(formData);
        }

        function finalizeSave(formData) {
            const characteristics = {};
            const characteristicRows = document.querySelectorAll('.characteristic-row');
            
            characteristicRows.forEach(row => {
                const keyInput = row.querySelector('input[name^="characteristic-key"]');
                const valueInput = row.querySelector('input[name^="characteristic-value"]');
                
                if (keyInput.value && valueInput.value) {
                    characteristics[keyInput.value] = valueInput.value;
                }
            });
            
            if (Object.keys(characteristics).length > 0) {
                formData.characteristics = characteristics;
            }
            
            if (currentEditingId) {
                const index = products.findIndex(p => p.id === currentEditingId);
                if (index !== -1) {
                    products[index] = { ...products[index], ...formData };
                }
            } else {
                products.push(formData);
            }
            
            localStorage.setItem('adminProducts', JSON.stringify(products));
            
            // –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ê –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–Ø
            syncWithMainSite();
            
            loadProducts();
            updateProductsCount();
            closeProductModal();
            
            alert(currentEditingId ? '–¢–æ–≤–∞—Ä —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!' : '–¢–æ–≤–∞—Ä —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!');
        }

        // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            currentEditingId = productId;
            document.getElementById('modal-title').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä';
            
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-model').value = product.model;
            document.getElementById('product-category').value = product.category;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-specs').value = product.specs || '';
            document.getElementById('product-description').value = product.description || '';
            
            productImages = [];
            if (product.images && product.images.length > 0) {
                product.images.forEach((imageData, index) => {
                    productImages.push({
                        id: Date.now() + index,
                        data: imageData,
                        isMain: index === 0 || imageData === product.mainImage
                    });
                });
            } else if (product.image) {
                productImages.push({
                    id: Date.now(),
                    data: product.image,
                    isMain: true
                });
            }
            updateImagePreviews();
            
            const container = document.getElementById('characteristics-container');
            container.innerHTML = '';
            
            if (product.characteristics) {
                Object.entries(product.characteristics).forEach(([key, value], index) => {
                    const characteristicRow = document.createElement('div');
                    characteristicRow.className = 'characteristic-row';
                    characteristicRow.innerHTML = `
                        <input type="text" placeholder="–ù–∞–∑–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏" name="characteristic-key-${index}" value="${key}">
                        <input type="text" placeholder="–ó–Ω–∞—á–µ–Ω–Ω—è" name="characteristic-value-${index}" value="${value}">
                        <button type="button" class="remove-characteristic" onclick="this.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    container.appendChild(characteristicRow);
                });
            }
            
            document.getElementById('product-modal').classList.add('active');
        }

        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
        function openDeleteModal(productId) {
            productToDelete = productId;
            document.getElementById('delete-modal').classList.add('active');
        }

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
        function closeDeleteModal() {
            productToDelete = null;
            document.getElementById('delete-modal').classList.remove('active');
        }

        // –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
        function confirmDelete() {
            if (productToDelete) {
                products = products.filter(p => p.id !== productToDelete);
                localStorage.setItem('adminProducts', JSON.stringify(products));
                
                syncWithMainSite();
                
                loadProducts();
                updateProductsCount();
                closeDeleteModal();
                alert('–¢–æ–≤–∞—Ä —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ!');
            }
        }

        // –ï–∫—Å–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä—ñ–≤
        function exportProducts() {
            if (products.length === 0) {
                alert('–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É!');
                return;
            }
            
            const dataStr = JSON.stringify(products, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `istore-products-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ê –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–Ø
        function syncWithMainSite() {
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∞–π—Ç—É
            localStorage.setItem('storeProducts', JSON.stringify(products));
            localStorage.setItem('productsLastUpdate', Date.now().toString());
            
            // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —á–µ—Ä–µ–∑ Broadcast Channel
            broadcastChannel.postMessage({
                type: 'products_updated',
                timestamp: Date.now(),
                count: products.length
            });
            
            // –°–ø—Ä–æ–±–∞ –æ–Ω–æ–≤–∏—Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –≤–∫–ª–∞–¥–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∞–π—Ç—É
            if (window.opener && !window.opener.closed) {
                try {
                    window.opener.postMessage({
                        type: 'products_updated',
                        timestamp: Date.now()
                    }, '*');
                } catch (e) {
                    console.log('–ù–µ –≤–¥–∞–ª–æ—Å—å –æ–Ω–æ–≤–∏—Ç–∏ –æ—Å–Ω–æ–≤–Ω—É –≤–∫–ª–∞–¥–∫—É');
                }
            }
            
            alert('‚úÖ –¢–æ–≤–∞—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ! –í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –ø–æ–±–∞—á–∞—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è.');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        function autoSyncOnLoad() {
            const adminProducts = JSON.parse(localStorage.getItem('adminProducts')) || [];
            const storeProducts = JSON.parse(localStorage.getItem('storeProducts')) || [];
            
            if (adminProducts.length > 0 && storeProducts.length === 0) {
                syncWithMainSite();
            }
        }

        // –ü—Ä–∏–ø–∏–Ω—è—î–º–æ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.addEventListener('beforeunload', function() {
            if (supportChatInterval) {
                clearInterval(supportChatInterval);
            }
        });
    </script>
</body>
</html>